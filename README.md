# PHP-MySQL Permaculture Plant Database

## 1. Overview

This project provides a set of PHP scripts to create and populate a MySQL database with plant information, intended for use in permaculture design and edible forest applications. It fetches data from external APIs (currently focusing on Permapeople.org) and stores it in a structured MySQL table.

The database schema is designed to be comprehensive, capturing various botanical, ecological, and cultivation attributes for each plant species.

## 2. File Structure

The project includes the following PHP scripts:

*   `config.sample.php`: A template for your database and API key configuration. You'll copy this to `config.php` and add your credentials.
*   `database_setup.php`: Connects to your MySQL server, creates the specified database (e.g., `permaculture_db`), and sets up the `species` table schema.
*   `fetch_trefle_data.php`: Fetches plant data from the Trefle.io API for a predefined list of plants. It attempts to use direct species slug URLs. Saves output to `trefle_data_direct.json`. (Currently, Trefle.io access has proven problematic).
*   `fetch_permapeople_data.php`: Fetches plant data from the Permapeople.org API for a predefined list of plants. Saves output to `permapeople_data.json`.
*   `insert_plant_data.php`: Reads a JSON file (generated by one of the fetch scripts) and inserts the plant data into the MySQL `species` table.
*   `test_retrieval.php`: Queries the database for a few sample records and displays them to verify that data has been inserted correctly.

## 3. Setup Instructions

### Prerequisites:
*   A MySQL server instance (e.g., local XAMPP, WAMP, MAMP, or a remote server).
*   PHP installed on your system, with the `mysqli` and `curl` extensions enabled.
*   API keys for data sources (see section 4).

### Configuration:
1.  **Copy `config.sample.php` to `config.php`**:
    ```bash
    cp config.sample.php config.php
    ```
2.  **Edit `config.php`** and provide the following details:
    *   **MySQL Credentials**:
        *   `DB_SERVER`: Your MySQL server address (e.g., 'localhost').
        *   `DB_USERNAME`: Your MySQL username.
        *   `DB_PASSWORD`: Your MySQL password.
        *   `DB_NAME`: The desired name for your database (e.g., 'permaculture_db'). This database will be created by `database_setup.php` if it doesn't exist.
    *   **API Keys** (see section 4 for details on obtaining these):
        *   `TREFLE_API_TOKEN`: Your API token for Trefle.io.
        *   `PERMAالفطر_API_KEY_ID`: Your API Key ID for Permapeople.org.
        *   `PERMAالفطر_API_KEY_SECRET`: Your API Key Secret for Permapeople.org.

## 4. API Key Information

This project relies on external APIs for plant data:

*   **Trefle.io**:
    *   Requires an access token.
    *   Sign up at [trefle.io](https://trefle.io/), confirm your email, log in, and find your token in your account profile.
    *   *Current Status*: Users have reported issues with the Trefle API (search and possibly direct species access). The `fetch_trefle_data.php` script attempts direct slug access but may not yield results if Trefle services are unavailable.
*   **Permapeople.org**:
    *   Requires an API Key ID and API Key Secret.
    *   Sign up at [permapeople.org](https://permapeople.org/) and request API access via their form: [permapeople.org/api_requests/new](https://permapeople.org/api_requests/new).
    *   *Current Status*: This is the primary functional data source for this project at the moment.

## 5. Order of Running Scripts

Execute the scripts from your command line using `php <script_name.php>`.

1.  **Setup Database (run once initially):**
    ```bash
    php database_setup.php
    ```
    This will create the database and the `species` table.

2.  **Fetch Data from Permapeople.org:**
    ```bash
    php fetch_permapeople_data.php
    ```
    This will create/overwrite `permapeople_data.json` with data for sample plants.

3.  **Insert Permapeople Data into Database:**
    ```bash
    php insert_plant_data.php permapeople_data.json
    ```

4.  **(Optional - Fetch Trefle.io Data - if issues are resolved):**
    ```bash
    php fetch_trefle_data.php
    ```
    This will create/overwrite `trefle_data_direct.json`.

5.  **(Optional - Insert Trefle Data):**
    ```bash
    php insert_plant_data.php trefle_data_direct.json
    ```

6.  **Test Data Retrieval:**
    ```bash
    php test_retrieval.php
    ```
    This script will query the database and display some of the inserted records and a total count.

## 6. Data Sources & Licensing

*   **Permapeople.org**: Data from this API is licensed under [CC BY-SA 4.0](https://creativecommons.org/licenses/by-sa/4.0/). If you use this data, you **must provide attribution to Permapeople.org** and distribute any derivative works under the same license. Please also review their [data acknowledgement](https://permapeople.org/knowledgebase/data-acknowledgement.html).
*   **Trefle.io**: Review Trefle.io's terms of service for data usage and licensing if you are able to access their data.

## 7. Notes

*   The `insert_plant_data.php` script uses `INSERT IGNORE`. This means if you try to insert a plant with an `id` that already exists in the database (e.g., from re-running a fetch and insert process for the same data source), it will be skipped. True de-duplication based on `scientific_name` across different data sources would require more complex logic and potentially schema adjustments (e.g., a unique index on `scientific_name`).
*   The mapping logic in the `fetch_*.php` scripts attempts to align data from the source APIs with the project's MySQL schema. Due to variations in API data structures, some fields in the database may remain null if the data is not available or not easily mapped from a particular source.
